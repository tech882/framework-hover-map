<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Waste & Circular Economy Frameworks — Hover Map</title>

  <style>
    :root{
      --bg:#ffffff;
      --ink:#111827;
      --muted:#6b7280;
      --border:#e5e7eb;
      --panel:#f9fafb;
      --shadow: 0 10px 25px rgba(0,0,0,.18);

      --eu:#16a34a;
      --nat:#f59e0b;
      --partial:#60a5fa;

      /* NEW: highlight "in_process" / "announced" status */
      --progress:#93c5fd;

      --none:#d1d5db;
      --unknown:#e5e7eb;
    }

    *{ box-sizing:border-box; }
    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      margin: 0;
      padding: 18px 16px;
      background: var(--bg);
      color: var(--ink);
    }

    #wrap{ max-width: 1200px; margin: 0 auto; }

    header{
      border: 1px solid var(--border);
      border-radius: 14px;
      background: #fff;
      padding: 14px 14px;
    }

    h1{
      margin: 0;
      font-size: 18px;
      font-weight: 900;
      letter-spacing: -0.01em;
    }

    h3{
      margin: 0 0 8px;
      font-size: 16px;
      font-weight: 900;
      letter-spacing: -0.01em;
    }

    .sub{
      margin: 8px 0 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.5;
      max-width: 980px;
    }

    .legend{
      display:flex;
      flex-wrap:wrap;
      gap: 10px;
      margin-top: 12px;
      font-size: 12px;
      color: var(--ink);
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 6px 10px;
      background: var(--panel);
    }

    .swatch{
      width: 12px;
      height: 12px;
      border-radius: 3px;
      display:inline-block;
      border: 1px solid rgba(0,0,0,.12);
    }

    .muted{ color: var(--muted); }

    .note{
      margin-top: 10px;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.45;
    }

    .downloads{
      margin-top: 10px;
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
    }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background:#fff;
      color: var(--ink);
      text-decoration:none;
      font-size: 13px;
      cursor:pointer;
    }
    .btn:hover{ background: var(--panel); }

    .section{
      padding: 16px 0 0;
    }

    /* Map area */
    #chart{
      position: relative;
      margin-top: 14px;
    }

    svg{
      width: 100%;
      height: auto;
      border: 1px solid var(--border);
      border-radius: 14px;
      background: #fff;
      display:block;
    }

    .country{
      cursor: pointer;
      stroke:#fff;
      stroke-width: .45;
    }

    .tooltip{
      position:absolute;
      display:none;
      min-width: 260px;
      max-width: 380px;
      background: rgba(17,24,39,.96);
      color:#fff;
      padding: 10px 12px;
      border-radius: 12px;
      font-size: 12px;
      line-height: 1.35;
      pointer-events:none;
      box-shadow: var(--shadow);
      z-index: 20;
    }

    .tooltip .title{
      font-weight: 900;
      font-size: 13px;
      margin-bottom: 6px;
    }

    .row{
      display:flex;
      justify-content:space-between;
      gap: 10px;
      margin-top: 3px;
    }

    .k{ opacity:.78; }
    .v{ font-weight: 700; text-align:right; }

    .links{
      margin-top: 8px;
    }
    .links a{
      color: #93c5fd;
      text-decoration:none;
      word-break: break-all;
    }
    .links a:hover{ text-decoration:underline; }

    /* Use-cases layout */
    .uc-grid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
    }
    @media (max-width: 980px){
      .uc-grid{ grid-template-columns: 1fr; }
    }
    .uc-card{
      border:1px solid var(--border);
      border-radius:14px;
      background:#fff;
      padding:12px;
    }
    .uc-title{
      font-weight:900;
      font-size:14px;
      margin-bottom:6px;
    }
    .uc-text{
      color:var(--muted);
      font-size:13px;
      line-height:1.5;
      margin-bottom:10px;
    }
    .uc-q{
      border-top:1px solid var(--border);
      padding-top:10px;
    }
    .uc-qh{
      font-size:12px;
      color:var(--muted);
      font-weight:800;
      margin-bottom:6px;
    }
    .uc-list{
      margin:0;
      padding-left:16px;
      color:var(--ink);
      font-size: 13px;
      line-height: 1.5;
    }
  </style>
</head>

<body>
<div id="wrap">

  <header>
    <h1>Waste & Circular Economy Frameworks — Interactive Hover Map</h1>
    <p class="sub">
      Hover a country to view a compact, audit-safe summary. Colors represent <strong>WasteFramework requirements</strong>.
      Where available, the tooltip includes source links for traceability.
    </p>

    <div class="legend" aria-label="Legend">
      <span class="badge"><span class="swatch" style="background:var(--eu);"></span>EU_directive</span>
      <span class="badge"><span class="swatch" style="background:var(--nat);"></span>national_equivalent</span>
      <span class="badge"><span class="swatch" style="background:var(--partial);"></span>partial / strategy_only</span>
      <span class="badge"><span class="swatch" style="background:var(--progress);"></span>ISSB in_process / announced</span>
      <span class="badge"><span class="swatch" style="background:var(--none);"></span>none</span>
      <span class="badge"><span class="swatch" style="background:var(--unknown);"></span>unknown</span>
    </div>

    <div class="note">
      Notes: This visualization is a data-driven summary and does not constitute legal advice.
      Classification fields reflect this dataset’s taxonomy; verify using linked primary sources where provided.
    </div>
  </header>

  <!-- USE-CASES -->
  <section id="use-cases" class="section" style="padding-top: 6px;">
    <h3>Sample use-cases</h3>
    <p class="muted" style="max-width: 980px; margin: 0;">
      Examples of how teams use this dataset for decision support and traceability. Classifications shown on the map
      reflect the dataset’s taxonomy; verify using linked primary sources where provided.
    </p>

    <div class="uc-grid" style="margin-top: 12px;">
      <div class="uc-card">
        <div class="uc-title">ESG reporting & strategy</div>
        <div class="uc-text">
          Compare jurisdictional framework indicators across operating countries and identify where EU-aligned
          or national-equivalent approaches appear in the dataset.
        </div>
        <div class="uc-q">
          <div class="uc-qh">Typical questions</div>
          <ul class="uc-list">
            <li>Where do EU-aligned waste or circular economy frameworks apply?</li>
            <li>Which countries show ISSB progress versus no identified status?</li>
            <li>Where does the dataset include source links vs. gaps?</li>
          </ul>
        </div>
      </div>

      <div class="uc-card">
        <div class="uc-title">Packaging & materials compliance</div>
        <div class="uc-text">
          Screen markets for waste and circular economy frameworks that may affect packaging design constraints,
          EoL assumptions, and compliance planning.
        </div>
        <div class="uc-q">
          <div class="uc-qh">Typical questions</div>
          <ul class="uc-list">
            <li>Which markets show EU directive applicability in the dataset?</li>
            <li>Where are frameworks marked partial or strategy-only?</li>
            <li>Which countries may warrant deeper legal review for packaging claims?</li>
          </ul>
        </div>
      </div>

      <div class="uc-card">
        <div class="uc-title">Procurement & supplier due diligence</div>
        <div class="uc-text">
          Overlay supplier geography with regulatory context to prioritize documentation requests and risk-based diligence.
        </div>
        <div class="uc-q">
          <div class="uc-qh">Typical questions</div>
          <ul class="uc-list">
            <li>Which supplier regions operate under higher-regulation frameworks?</li>
            <li>Where should enhanced documentation be requested?</li>
            <li>Which locations may face near-term policy change?</li>
          </ul>
        </div>
      </div>

      <div class="uc-card">
        <div class="uc-title">Audits & assurance preparation</div>
        <div class="uc-text">
          Use consistent classifications and linked sources to support internal reviews, audit readiness, and traceability.
        </div>
        <div class="uc-q">
          <div class="uc-qh">Typical questions</div>
          <ul class="uc-list">
            <li>What regulatory assumptions are implied by our country classifications?</li>
            <li>Which entries include authoritative sources we can cite?</li>
            <li>Where do we need to fill source gaps before assurance?</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="note" style="margin-top: 10px;">
      Note: This visualization is for information and data exploration and does not constitute legal advice.
    </div>
  </section>

  <!-- MAP -->
  <div id="chart">
    <div id="tooltip" class="tooltip" role="dialog" aria-hidden="true"></div>
  </div>

</div>

<!-- D3 + TopoJSON from CDN -->
<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
<script src="https://cdn.jsdelivr.net/npm/topojson-client@3"></script>

<script>
(async function () {
  const tooltip = document.getElementById("tooltip");
  const chart = document.getElementById("chart");

  // ----------------------------
  // Update these paths if needed
  // ----------------------------
  const DATA_JSON_PATH = "./csrd_issb_gri_waste_circular_frameworks_iso.json";
  // If your JSON lives under /data, use:
  // const DATA_JSON_PATH = "./data/csrd_issb_gri_waste_circular_frameworks_iso.json";

  // 1) Load dataset (local)
  const data = await fetch(DATA_JSON_PATH).then(r => r.json());

  // Index by ISO numeric (3-digit string); matches world-atlas feature ids
  const index = new Map(data.map(d => [String(d.ISO_N3).padStart(3, "0"), d]));

  // 2) Load world geometry (TopoJSON) from CDN
  const world = await fetch("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json").then(r => r.json());
  const countries = topojson.feature(world, world.objects.countries).features;

  // 3) Set up SVG
  const width = 1100, height = 560;
  const svg = d3.select(chart).append("svg").attr("viewBox", `0 0 ${width} ${height}`);

  const projection = d3.geoNaturalEarth1().fitSize([width, height], { type: "Sphere" });
  const geoPath = d3.geoPath(projection);

  function getCss(v){
    return getComputedStyle(document.documentElement).getPropertyValue(v).trim();
  }

  function color(wfType, issbStatus){
    // 1) EU_directive has top priority
    if (wfType === "EU_directive") {
      return getCss("--eu");
    }
  
    // 2) Only if NOT EU_directive, allow ISSB highlight
    if (issbStatus === "in_process_or_announced") {
      return getCss("--progress");
    }
  
    // 3) Otherwise, color by waste framework type
    switch (wfType) {
      case "national_equivalent": return getCss("--nat");
      case "partial": return getCss("--partial");
      case "strategy_only": return getCss("--partial");
      case "none": return getCss("--none");
      default: return getCss("--unknown");
    }
  }

  function escapeHtml(s) {
    return String(s ?? "").replace(/[&<>"']/g, c => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
    }[c]));
  }

  function linkRow(label, url){
    if (!url) return "";
    const u = escapeHtml(url);
    return `
      <div class="links">
        <div class="k" style="opacity:.85;">${escapeHtml(label)}:</div>
        <a href="${u}" target="_blank" rel="noopener">${u}</a>
      </div>
    `;
  }

  function makeTooltipHtml(d) {
    const waste = d.WasteFramework_type || "unknown";
    const circ  = d.CircularEconomyFramework_type || "unknown";
    const issb  = d.ISSB_status || "unknown";

    return `
      <div class="title">
        ${escapeHtml(d.Country)} <span style="opacity:.75;font-weight:700;">(${escapeHtml(d.ISO2 || "")})</span>
      </div>

      <div class="row"><div class="k">WasteFramework_type</div><div class="v">${escapeHtml(waste)}</div></div>
      <div class="row"><div class="k">CircularEconomyFramework_type</div><div class="v">${escapeHtml(circ)}</div></div>
      <div class="row"><div class="k">ISSB_status</div><div class="v">${escapeHtml(issb)}</div></div>
      <div class="row"><div class="k">GRI</div><div class="v">voluntary standard</div></div>

      ${linkRow("WasteFramework_source", d.WasteFramework_source)}
      ${linkRow("CircularEconomyFramework_source", d.CircularEconomyFramework_source)}
      ${linkRow("ISSB_source", d.ISSB_source)}
      ${linkRow("GRI_source", d.GRI_source)}

      <div class="note" style="color:rgba(255,255,255,.78); margin-top:10px;">
        Classification fields reflect this dataset’s taxonomy; verify using linked primary sources where provided.
      </div>
    `;
  }

  function showTooltip(evt, html) {
    tooltip.innerHTML = html;
    tooltip.style.display = "block";
    tooltip.setAttribute("aria-hidden", "false");
    moveTooltip(evt);
  }

  function moveTooltip(evt) {
    const pad = 12;
    const rect = chart.getBoundingClientRect();

    let x = evt.clientX - rect.left + pad;
    let y = evt.clientY - rect.top + pad;

    const tipW = tooltip.offsetWidth || 320;
    const tipH = tooltip.offsetHeight || 160;

    const maxX = rect.width - tipW - pad;
    const maxY = rect.height - tipH - pad;

    x = Math.max(pad, Math.min(x, maxX));
    y = Math.max(pad, Math.min(y, maxY));

    tooltip.style.left = x + "px";
    tooltip.style.top  = y + "px";
  }

  function hideTooltip() {
    tooltip.style.display = "none";
    tooltip.setAttribute("aria-hidden", "true");
  }

  // Background (ocean)
  svg.append("path")
    .datum({ type: "Sphere" })
    .attr("d", geoPath)
    .attr("fill", getCss("--panel"));

  // Countries
  svg.append("g")
    .selectAll("path")
    .data(countries)
    .join("path")
      .attr("class", "country")
      .attr("fill", f => {
        const id = String(f.id).padStart(3, "0");
        const d = index.get(id);
        return d ? color(d.WasteFramework_type, d.ISSB_status) : getCss("--unknown");
      })
      .attr("d", geoPath)
      .on("mousemove", moveTooltip)
      .on("mouseenter", (evt, f) => {
        const id = String(f.id).padStart(3, "0");
        const d = index.get(id);
        if (!d) return;
        showTooltip(evt, makeTooltipHtml(d));
      })
      .on("mouseleave", hideTooltip);

})();
</script>
</body>
</html>

